!function(e){"use strict";function t(t,o){var n=document.createElement("div"),i=document.createElement("div");n.classList.add("seditor-wrapper"),i.classList.add("seditor-toolbar");var r=this;this.selectedRange=null;var a=t.cloneNode();t.replaceWith(n),this.editor=t=a,t.classList.add("seditor-content"),n.appendChild(i),n.appendChild(t),this.toolWrapper=i;var l={toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-active",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,keypressTimeout:200,file:{error:function(e,t){console.log("File upload error",e,t)}},widgetLabels:{font:"Font",forecolor:"Font Color",backcolor:"Background Color",fontsize:"Font Size"},widgetAlias:{font:"fontName"},widgetDetails:{font:["Serif","Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"].map(function(e){return{key:e,style:"font-family:"+e,text:e}}),fontsize:[{key:7,style:"font-size: xx-large",text:"xx-large"},{key:6,style:"font-size: x-large",text:"x-large"},{key:5,style:"font-size: large",text:"large"},{key:4,style:"font-size: medium",text:"medium"},{key:3,style:"font-size: small",text:"small"},{key:2,style:"font-size: x-small",text:"x-small"},{key:1,style:"font-size: xx-small",text:"xx-small"}],forecolor:["#000000","#0000FF","#30AD23","#FF7F00","#FF0000","#FFFF00","#FFFFFF"].map(function(e){return{key:e,style:"color:"+e}}),backcolor:["#000000","#0000FF","#30AD23","#FF7F00","#FF0000","#FFFF00","#FFFFFF"].map(function(e){return{key:e,style:"background:"+e}})},widgetIcons:{font:"text-height",backcolor:"paint-brush",forecolor:"font",insertunorderedlist:"list-ul",insertorderedlist:"list-ol",justifyleft:"align-left",justifycenter:"align-center",justifyright:"align-right",justifyfull:"align-justify",redo:"repeat",fontsize:"header"},widgets:["font","fontsize","forecolor","backcolor",["bold","italic","strikethrough","underline"],["insertunorderedlist","insertorderedlist","outdent","indent"],["justifyleft","justifycenter","justifyright","justifyfull"],"link",["unlink","image"],["undo","redo"]]},s=Object.assign({},l,o),d="a[data-"+s.commandRole+"],button[data-"+s.commandRole+"],input[type=button][data-"+s.commandRole+"]";s.dragAndDropImages&&this.initFileDrops(t,s,d),this.setupToolbar(i,s),this.bindToolbar(t,i,s,d),t.setAttribute("contenteditable",!0),["mouseup","keyup","mouseout"].forEach(function(e){t.addEventListener(e,function(){r.saveSelection(),r.updateToolbar(t,d,s)})}),e.addEventListener("touchend",function(e){var o=t.is(e.target)||t.has(e.target).length>0,n=this.getCurrentRange(),i=n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset;i&&!o||(r.saveSelection(),r.updateToolbar(t,d,s))}),document.querySelectorAll(".seditor-btn-group a.seditor-dropdown-toggle").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".seditor-btn-group .seditor-dropdown-menu.show").forEach(function(e){e!==t&&e.classList.remove("show")});var t=this.parentNode.querySelector(".seditor-dropdown-menu");t&&t.classList.toggle("show")}.bind(e))}),document.querySelectorAll(".seditor-btn-group .seditor-dropdown-menu").forEach(function(e){e.addEventListener("blur",function(t){e.classList.remove("show")})}),document.body.addEventListener("click",function(e){document.querySelectorAll(".seditor-btn-group .seditor-dropdown-menu.show").forEach(function(t){e.path.indexOf(t)===-1&&t.classList.remove("show")})})}function o(t){if(e.getSelection&&document.createRange){var o=e.getSelection(),n=document.createRange();n.selectNodeContents(t),o.removeAllRanges(),o.addRange(n)}else if(document.selection&&document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(t),i.select()}}t.prototype.readFileIntoDataUrl=function(e,t){return t.file.uploader&&"function"==typeof t.file.uploader?new Promise(function(o,n){t.file.uploader(e,o)}):new Promise(function(t,o){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=o,n.readAsDataURL(e)})},t.prototype.setupToolbar=function(e,t){var o="",n=this;t.widgets.forEach(function(e){"string"==typeof e?o+='<div class="seditor-btn-group">'+n.setupToolBtn(e,t)+"</div>":(o+='<div class="seditor-btn-group">',e.forEach(function(e){o+=n.setupToolBtn(e,t)}),o+="</div>")}),e.innerHTML=o},t.prototype.setupToolBtn=function(e,t){if("link"===e)return this.hasCreateLink=!0,'<a class="seditor-btn seditor-btn-default seditor-dropdown-toggle" title="Hyperlink"><i class="fa fa-link"></i></a><div class="seditor-dropdown-menu seditor-input-append"><input placeholder="URL" type="text" data-'+t.commandRole+'="createLink" /><button class="seditor-btn seditor-btn-createlink" type="button">Add</button></div>';if("image"===e)return'<label class="seditor-btn seditor-btn-default" title="Insert picture"> <i class="fa fa-picture-o"></i><input class="imgUpload" type="file" data-role="magic-overlay" data-target="#pictureBtn" data-'+t.commandRole+'="insertImage" /></label>';if(t.widgetDetails[e]){var o='<a class="seditor-btn seditor-btn-default seditor-dropdown-toggle" title="'+e+'"><i class="fa fa-'+(t.widgetIcons[e]||e)+'"></i><span class="seditor-btn-title">'+(t.widgetLabels[e]||e||"")+'</span><i class="fa fa-caret-down"></i></a>',n='<ul class="seditor-dropdown-menu">';return t.widgetDetails[e].forEach(function(o){var i,r,a;i=r=o,e=t.widgetAlias[e]||e,"object"==typeof o&&(i=o.key,r=o.text||i,a=o.style),n+="<li><a data-"+t.commandRole+'="'+e+" "+i+'" data-key="'+i+'" ',a&&(n+='style="'+a+'"'),n+=">"+r+"</a></li>"}),n+="</ul>",o+n}return'<a class="seditor-btn seditor-btn-default" data-'+t.commandRole+'="'+e+'" title="'+e+'"><i class="fa fa-'+(t.widgetIcons[e]||e)+'"></i></a>'},t.prototype.cleanHtml=function(e){var t=this;"true"===String(t.editor.dataset.htmlMode)&&(t.editor.innerHTML=t.editor.textContent,t.editor.setAttribute("contenteditable",!0),t.editor.dataset.htmlMode=!1);var o=t.editor.innerHTML;return t.editor.innerHTML="",o},t.prototype.updateToolbar=function(e,t,o){o.activeToolbarClass&&this.toolWrapper.querySelectorAll(t).forEach(function(e){var t=e.dataset,n=t[o.commandRole].split(" "),i=n[0];n.length>1&&document.queryCommandEnabled(i)&&document.queryCommandValue(i)===n[1]?e.classList.add(o.activeToolbarClass):1===n.length&&document.queryCommandEnabled(i)&&document.queryCommandState(i)?e.classList.add(o.activeToolbarClass):e.classList.remove(o.activeToolbarClass)})},t.prototype.execCommand=function(e,t,o,n,i){if("true"===String(o.dataset.htmlMode))return void console.log("html mode, rich editor disabled");var r=e.split(" "),a=r.shift(),l=r.join(" ")+(t||""),s=e.split("-");1===s.length?document.execCommand(a,!1,l):"format"===s[0]&&2===s.length&&document.execCommand("formatBlock",!1,s[1]),this.updateToolbar(o,i,n)},t.prototype.getCurrentRange=function(){var t,o;return e.getSelection?(t=e.getSelection(),t.getRangeAt&&t.rangeCount&&(o=t.getRangeAt(0))):document.selection&&(o=document.selection.createRange()),o},t.prototype.saveSelection=function(){this.selectedRange=this.getCurrentRange()},t.prototype.restoreSelection=function(){var t;if(e.getSelection||document.createRange){if(t=e.getSelection(),this.selectedRange){try{t.removeAllRanges()}catch(o){document.body.createTextRange().select(),document.selection.empty()}t.addRange(this.selectedRange)}}else document.selection&&this.selectedRange&&this.selectedRange.select()},t.prototype.toggleHtmlEdit=function(){var e=this.editor;if("true"!==String(e.dataset.htmlMode)){var t=e.innerHTML,o=document.createElement("pre");o.appendChild(document.createTextNode(t)),o.setAttribute("contenteditable",!0),e.pre=o,e.innerHTML=" ",e.appendChild(o),e.setAttribute("contenteditable",!1),e.dataset.htmlMode=!0,e.focus()}else e.pre?(e.innerHTML=e.pre.innerText,e.pre=null):e.innerHTML=e.innerText,e.setAttribute("contenteditable",!0),e.dataset.htmlMode=!1,e.focus()},t.prototype.insertFiles=function(e,t,o,n){var i=this;o.focus();for(var r=0,a=e.length;r<a;r++)!function(e,r){/^image\//.test(r.type)?i.readFileIntoDataUrl(r,t).then(function(e){i.execCommand("insertimage",e,o,t,n)})["catch"](function(e){t.file.error("file-reader",e)}):t.file.error("unsupported-file-type",r.type)}(r,e[r])},t.prototype.markSelection=function(e,t){this.restoreSelection(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",!1,e||"transparent"),this.saveSelection()},t.prototype.bindToolbar=function(t,n,i,r){var a=this;n.querySelectorAll(r).forEach(function(e){e.addEventListener("click",function(){a.restoreSelection(),t.focus(),"html"===t.dataset[i.commandRole]?a.toggleHtmlEdit():a.execCommand(this.dataset[i.commandRole],null,t,i,r),a.saveSelection()}.bind(e))}),["webkitspeechchange, change"].forEach(function(l){n.querySelectorAll("input[type=text][data-"+i.commandRole+"]").forEach(function(n){n.addEventListener(l,function(){var n=this.value;this.value="",a.restoreSelection();var l=e.getSelection();""===l.toString().trim()&&n&&(a.editor.append("<span>"+n+"</span>"),o(a.editor.querySelector("span:last"))),n&&(t.focus(),a.execCommand(this.dataset[i.commandRole],n,t,i,r)),a.saveSelection()}.bind(n))})}),n.querySelectorAll("input[type=text][data-"+i.commandRole+"]").forEach(function(e){e.addEventListener("blur",function(){a.markSelection(!1,i)})}),n.querySelectorAll("input[type=file][data-"+i.commandRole+"]").forEach(function(e){e.addEventListener("change",function(){a.restoreSelection(),"file"===this.type&&this.files&&this.files.length>0&&a.insertFiles(this.files,i,t,r),a.saveSelection(),this.value=""})}),this.hasCreateLink&&n.querySelectorAll(".seditor-btn-createlink").forEach(function(e){e.addEventListener("click",function(){a.restoreSelection(),t.focus();var e=this.parentNode.querySelector("input");e&&e.value&&e.value.trim()&&("html"===t.dataset[i.commandRole]?a.toggleHtmlEdit():a.execCommand(e.dataset[i.commandRole],e.value,t,i,r),this.parentNode.classList.remove("show")),a.saveSelection()})})},t.prototype.initFileDrops=function(e,t,o){var n=this;e.addEventListener("drop",function(i){var r=i.dataTransfer;i.stopPropagation(),i.preventDefault(),r&&r.files&&r.files.length>0&&n.insertFiles(r.files,t,e,o)}),["dragenter","dragover"].forEach(function(t){e.addEventListener(t,function(e){return!1})})},e.sEditor=function(e,o){var n=[];return document.querySelectorAll(e).forEach(function(e){n.push(new t(e,o))}),1===n.length&&(n=n[0]),n}}(window);
